const parsePath = require('./lib/parse-path')
const setValue = require('./lib/set-value')

function appendField (store, key, value) {
  const steps = parsePath(key)

  // Check if the key is valid
  if (steps.some(step => typeof step !== 'object' || !('key' in step))) {
    throw new Error('Invalid key format')
  }

  let context = store

  // Iterate through the steps and set the value
  for (const step of steps) {
    context = setValue(context, step.key, context[step.key], value)
  }

  return store
}

module.exports = appendField

