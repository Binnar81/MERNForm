#!/usr/bin/env pwsh

$script:basedir = Split-Path $MyInvocation.MyCommand.Definition -Parent
$script:exe = if ($PSVersionTable.PSVersion -lt "6.0" -or $IsWindows) { ".exe" } else { "" }
$script:nodePath = "$basedir/node$exe"

function Invoke-NodeCommand {
  [CmdletBinding()]
  param (
    [Parameter(Mandatory=$true)]
    [string]$scriptPath,

    [Parameter(ValueFromRemainingArguments=$true)]
    [string[]]$args
  )

  if (Test-Path $scriptPath) {
    # Support pipeline input
    if ($MyInvocation.ExpectingInput) {
      $input | & "$nodePath" $scriptPath $args
    } else {
      & "$nodePath" $scriptPath $args
    }
    $global:LASTEXITCODE = $script:ret
  } else {
    Write-Error "File not found: $scriptPath"
  }
}

$script:ret = 0
Invoke-NodeCommand "$basedir/../mkdirp/bin/cmd.js" $args
exit $script:ret
